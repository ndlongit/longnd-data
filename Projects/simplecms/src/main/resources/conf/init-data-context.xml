<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation="http://www.springframework.org/schema/beans 
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd
           http://www.springframework.org/schema/tx 
           http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">
           
    <bean id="userDataInitializer" class="vn.pyco.tinycms.services.init.UserDataInitializer">
        <property name="initId" value="userDataInitializer" />
        <property name="orderConstraints" value="before:*" />
        
        <property name="initAuthorities">
            <list>
                <ref local="initAuthority1" />
                <ref local="initAuthority2" />
                <ref local="initAuthority3" />
            </list>
        </property>
        
        <property name="initUsers">
            <list>
                <ref local="initUser1" />
                <ref local="initUser2" />
                <ref local="initUser3" />
                <ref local="initUser4" />
                <ref local="initUser5" />
            </list>
        </property>
    </bean>
    
    <bean id="contentDataInitializer" class="vn.pyco.tinycms.services.init.ContentDataInitializer">
        <property name="initId" value="contentDataInitializer" />
        <property name="orderConstraints" value="before:siteDataInitializer" />
        
        <property name="propertyTypes">
            <list>
                <ref local="initPropertyType1" />
                <ref local="initPropertyType2" />
                <ref local="initPropertyType3" />
                <ref local="initPropertyType4" />
                <ref local="initPropertyType5" />
                <ref local="initPropertyType6" />
                <ref local="initPropertyType7" />
                <ref local="initPropertyType8" />
                <ref local="initPropertyType9" />
            </list>
        </property>
        
        <property name="contentTypes">
            <list>
                <ref local="initContentType1" />
            </list>
        </property>
        
        <property name="contents">
            <list>
                <ref local="initContent1" />
            </list>
        </property>
    </bean>    
    
    <bean id="siteDataInitializer" class="vn.pyco.tinycms.services.init.SiteDataInitializer">
        <property name="initId" value="siteDataInitializer" />
        
        <property name="masterTemplates">
            <list>
                <ref local="initMasterTemplate1" />
            </list>
        </property>
        
        <property name="contentTemplates">
            <list>
                <ref local="initContentTemplate1" />
                <ref local="initContentTemplate2" />
            </list>
        </property>
        
        <!--  
        Site tree:
        demo
        +- section1 
        |   +- section11
        |       +- page111
        |       +- page112
        +- section2
        |   +- page21
        |   +- page22 (default)
        +- page1 (integrated with contents)
        +- page2 (secured)
        -->
        <property name="nodes">
            <list>
                <ref local="initSite1" />
                <ref local="initSection1" />
                <ref local="initSection11" />
                <ref local="initPage111" />
                <ref local="initPage112" />
                <ref local="initSection2" />
                <ref local="initPage21" />
                <ref local="initPage22" />
                <ref local="initPage1" />
                <ref local="initPage2" />
            </list>
        </property>
    </bean>

    <!-- default authorities -->
    <bean id="initAuthority1" class="vn.pyco.tinycms.model.Authority">
        <property name="authority" value="ROLE_ADMIN" />
    </bean>
    <bean id="initAuthority2" class="vn.pyco.tinycms.model.Authority">
        <property name="authority" value="ROLE_WRITER" />
    </bean>
    <bean id="initAuthority3" class="vn.pyco.tinycms.model.Authority">
        <property name="authority" value="ROLE_PUBLISHER" />
    </bean>
    
    <!-- default users -->
    <bean id="initUser1" class="vn.pyco.tinycms.model.User">
        <property name="type" value="SA" />
        <property name="username" value="system" />
        <property name="password" value="system" />
        <property name="firstName" value="Administrator" />
        <property name="lastName" value="System" />
        <property name="email" value="system@tinycms.net" />
    </bean>
    <bean id="initUser2" class="vn.pyco.tinycms.model.User">
        <property name="type" value="BO" />
        <property name="username" value="admin" />
        <property name="password" value="admin" />
        <property name="firstName" value="Administrator" />
        <property name="lastName" value="System" />
        <property name="email" value="admin@tinycms.net" />
        <property name="authorities">
            <list>
                <ref local="initAuthority1" />
            </list>
        </property>
    </bean>
    <bean id="initUser3" class="vn.pyco.tinycms.model.User">
        <property name="type" value="BO" />
        <property name="username" value="writer" />
        <property name="password" value="writer" />
        <property name="firstName" value="Writer" />
        <property name="lastName" value="System" />
        <property name="email" value="writer@tinycms.net" />
        <property name="authorities">
            <list>
                <ref local="initAuthority2" />
            </list>
        </property>
    </bean>
    <bean id="initUser4" class="vn.pyco.tinycms.model.User">
        <property name="type" value="BO" />
        <property name="username" value="publisher" />
        <property name="password" value="publisher" />
        <property name="firstName" value="Publisher" />
        <property name="lastName" value="System" />
        <property name="email" value="publisher@tinycms.net" />
        <property name="authorities">
            <list>
                <ref local="initAuthority3" />
            </list>
        </property>
    </bean>
    <bean id="initUser5" class="vn.pyco.tinycms.model.User">
        <property name="type" value="FO" />
        <property name="username" value="extranet" />
        <property name="password" value="extranet" />
        <property name="firstName" value="Extranet" />
        <property name="lastName" value="System" />
        <property name="email" value="extranet@tinycms.net" />
    </bean>
    
    <!-- default property-types -->
    <bean id="initPropertyType1" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="Boolean" />
    </bean>
    <bean id="initPropertyType2" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="Integer" />
    </bean>
    <bean id="initPropertyType3" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="Double" />
    </bean>
    <bean id="initPropertyType4" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="String" />
    </bean>
    <bean id="initPropertyType5" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="PlainText" />
    </bean>
    <bean id="initPropertyType6" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="RichText" />
    </bean>
    <bean id="initPropertyType7" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="Enum" />
    </bean>
    <bean id="initPropertyType8" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="Date" />
    </bean>
    <bean id="initPropertyType9" class="vn.pyco.tinycms.model.PropertyType">
        <property name="name" value="File" />
    </bean>
    
    <!-- default content-types -->
    <bean id="initContentType1" class="vn.pyco.tinycms.model.ContentType">
        <property name="name" value="BookInfo" />
        <property name="description" value="A definition of the Book information content-type" />
        <property name="properties">
            <list>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="title" />
                    <property name="constraints" value="maxlength=128" />
                    <property name="order" value="1" />
                    <property name="propertyType" ref="initPropertyType4" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="coverImage" />
                    <property name="constraints" value="maxfilesize=512K" />
                    <property name="order" value="2" />
                    <property name="propertyType" ref="initPropertyType9" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="summary" />
                    <property name="constraints" value="maxlength=512" />
                    <property name="order" value="3" />
                    <property name="propertyType" ref="initPropertyType5" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="samplePage" />
                    <property name="constraints" value="maxlength=5120" />
                    <property name="order" value="4" />
                    <property name="propertyType" ref="initPropertyType6" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="publishedDate" />
                    <property name="constraints" value="min=NOW" />
                    <property name="order" value="5" />
                    <property name="propertyType" ref="initPropertyType8" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="publisher" />
                    <property name="constraints" value="O'Reilly Media,Prentice Hall,Addison Wesley,Manning Publications,Packt Publishing" />
                    <property name="order" value="6" />
                    <property name="propertyType" ref="initPropertyType7" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="reviewed" />
                    <property name="order" value="7" />
                    <property name="propertyType" ref="initPropertyType1" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="rate" />
                    <property name="constraints" value="min=1,max=10" />
                    <property name="order" value="8" />
                    <property name="propertyType" ref="initPropertyType2" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentProperty">
                    <property name="code" value="price" />
                    <property name="constraints" value="min=0" />
                    <property name="order" value="9" />
                    <property name="propertyType" ref="initPropertyType4" />
                </bean>
            </list>
        </property>
    </bean>
    
    <!-- default contents -->
    <bean id="initContent1" class="vn.pyco.tinycms.model.Content">
        <property name="name" value="book1" />
        <property name="contentType" ref="initContentType1" />
        <property name="data">
            <list>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="title" />
                    <property name="data" value="Tapestry 5: Building Web Applications" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="coverImage" />
                    <property name="data" value="/tinycms/assets/ctx/1.0-SNAPSHOT/images/tapestry5-book-cover.jpg" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="summary" />
                    <property name="data">
                        <value><![CDATA[
                        This book is a practical step-by-step tutorial for those who want to build contemporary, 
                        real-life web applications with Tapestry 5, the Apache open-source framework for creating dynamic, 
                        robust, highly scalable web applications in Java. It shows the path of least resistance, 
                        so that the reader can learn all the essential skills quickly and easily. 
                        To give the reader an initial practical experience, a simple but useful web application 
                        is built throughout the chapters.
                        ]]></value>
                    </property>
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="samplePage" />
                    <property name="data">
                        <value><![CDATA[
                        <h3>User Input Validation</h3>
                        One of the benefits of having a web application is that it can be very easily accessed 
                        by everyone around the world. One of the downsides of this is that when so many 
                        people use your application, they are going to have errors in their input. Some 
                        people are not attentive, others are tired and, finally, everyone in this world has 
                        his or her individual style of thinking, so something that seems obvious to the 
                        developers of the application might puzzle someone else.
                        A well-designed web application should immediately be able to define that the 
                        input is wrong and stop otherwise all kinds of errors can happen inside of the 
                        application. If this application is user-friendly, it should:
                        <ul>
                            <li>Clearly and unambiguously inform the user that some part of the input is 
                        erroneous, and should be corrected.</li>
                            <li>Identify the field that is erroneous and mark it in some way.</li>
                            <li>If possible, display the erroneous value, and maybe even explain why exactly 
                        it is wrong.</li>
                        </ul>
                        Let's see how Tapestry 5, being a highly efficient and user-friendly framework, 
                        handles these issues.
                        <h4>Adding Validation to Components</h4>
                        Have a look at the <strong>Start</strong> page of the running <strong>Celebrity Collector</strong>. There is a login 
                        form that expects the user to enter some values into its two fields. But, what if the 
                        user didn't enter anything and still clicked on the <strong>Log In</strong> button? Currently, the 
                        application will decide that the credentials are wrong and the user will be redirected 
                        to the <strong>Registration</strong> page, and receive an invitation to register. This logic does make 
                        some sense; but, it isn't the best line of action, as the button might have been pressed  
                        by mistake.
                        ]]></value>
                    </property>
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="publishedDate" />
                    <property name="data" value="2008-01-15" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="publisher" />
                    <property name="data" value="Packt Publishing" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="reviewed" />
                    <property name="data" value="true" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="rate" />
                    <property name="data" value="8" />
                </bean>
                <bean class="vn.pyco.tinycms.model.ContentData">
                    <property name="code" value="price" />
                    <property name="data" value="35.99" />
                </bean>
            </list>
        </property>
    </bean>
    
    <!-- default site/section/page -->
    <bean id="initSite1" class="vn.pyco.tinycms.model.Site">
        <property name="alias" value="demo" />
        <property name="title" value="Demo Title" />
        <property name="description" value="Demo Description" />
    </bean>
    <bean id="initSection1" class="vn.pyco.tinycms.model.Section">
        <property name="alias" value="section1" />
        <property name="title" value="Section 1" />
        <property name="parent" ref="initSite1" />
    </bean>
    <bean id="initSection11" class="vn.pyco.tinycms.model.Section">
        <property name="alias" value="section11" />
        <property name="title" value="Section 11" />
        <property name="parent" ref="initSection1" />
    </bean>
    <bean id="initPage111" class="vn.pyco.tinycms.model.Page">
        <property name="alias" value="page111" />
        <property name="parent" ref="initSection11" />
        <property name="title" value="Page 111" />
        <property name="masterTemplate" ref="initMasterTemplate1" />
        <property name="contentTemplate" ref="initContentTemplate1" />
        <property name="models">
            <list>
                <bean class="vn.pyco.tinycms.model.PageModel">
                    <property name="name" value="content" />
                    <property name="value" value="value111" />
                </bean>
            </list>
        </property>
    </bean>
    <bean id="initPage112" class="vn.pyco.tinycms.model.Page">
        <property name="alias" value="page112" />
        <property name="parent" ref="initSection11" />
        <property name="title" value="Page 112" />
        <property name="masterTemplate" ref="initMasterTemplate1" />
        <property name="contentTemplate" ref="initContentTemplate1" />
        <property name="models">
            <list>
                <bean class="vn.pyco.tinycms.model.PageModel">
                    <property name="name" value="content" />
                    <property name="value" value="value112" />
                </bean>
            </list>
        </property>
    </bean>
    <bean id="initSection2" class="vn.pyco.tinycms.model.Section">
        <property name="alias" value="section2" />
        <property name="title" value="Section 2" />
        <property name="parent" ref="initSite1" />
    </bean>
    <bean id="initPage21" class="vn.pyco.tinycms.model.Page">
        <property name="alias" value="page21" />
        <property name="parent" ref="initSection2" />
        <property name="title" value="Page 21" />
        <property name="masterTemplate" ref="initMasterTemplate1" />
        <property name="contentTemplate" ref="initContentTemplate1" />
        <property name="models">
            <list>
                <bean class="vn.pyco.tinycms.model.PageModel">
                    <property name="name" value="content" />
                    <property name="value" value="value21" />
                </bean>
            </list>
        </property>
    </bean>
    <bean id="initPage22" class="vn.pyco.tinycms.model.Page">
        <property name="alias" value="page22" />
        <property name="parent" ref="initSection2" />
        <property name="title" value="Default Page" />
        <property name="default" value="true" />
        <property name="masterTemplate" ref="initMasterTemplate1" />
        <property name="contentTemplate" ref="initContentTemplate1" />
        <property name="models">
            <list>
                <bean class="vn.pyco.tinycms.model.PageModel">
                    <property name="name" value="content" />
                    <property name="value" value="value22" />
                </bean>
            </list>
        </property>
    </bean>
    <bean id="initPage1" class="vn.pyco.tinycms.model.Page">
        <property name="alias" value="page1" />
        <property name="parent" ref="initSite1" />
        <property name="title" value="Book Information" />
        <property name="masterTemplate" ref="initMasterTemplate1" />
        <property name="contentTemplate" ref="initContentTemplate2" />
        <property name="models">
            <list>
                <bean class="vn.pyco.tinycms.model.PageModel">
                    <property name="name" value="book" />
                    <property name="value" value="1" />
                    <property name="type" value="vn.pyco.tinycms.model.Content" />
                </bean>
            </list>
        </property>
    </bean>
    <bean id="initPage2" class="vn.pyco.tinycms.model.Page">
        <property name="alias" value="page2" />
        <property name="parent" ref="initSite1" />
        <property name="title" value="Secured Page" />
        <property name="secured" value="true" />
        <property name="masterTemplate" ref="initMasterTemplate1" />
        <property name="contentTemplate" ref="initContentTemplate1" />
        <property name="models">
            <list>
                <bean class="vn.pyco.tinycms.model.PageModel">
                    <property name="name" value="content" />
                    <property name="value" value="value2" />
                </bean>
            </list>
        </property>
    </bean>
    
    <!-- default masterpage/contentpage templates -->
    <bean id="initMasterTemplate1" class="vn.pyco.tinycms.model.MasterPageTemplate">
        <property name="template">
            <value><![CDATA[
            <div id="fopage">
                <h3>Navigation</h3>
                <div id="navbar">
                    #{tinycms:navbar}
                </div>
                <h3 id='title' onclick='showMe(this)'>${PAGE.title}</h3>
                <div>
                    #{tinycms:search} #{tinycms:rss}
                </div>
                #{tinycms:body}
            </div>
            ]]></value>
        </property>
        <property name="cssCode">
            <value><![CDATA[
            div#fopage h3#title {
                background-color: #dedede;
            }
            div#fopage h1,
            div#fopage h2 {
                margin: 1em 0 0 0;
            }
            div#fopage li {
                margin-left: 2em;
            }
            ]]></value>
        </property>
        <property name="jsCode">
            <value><![CDATA[
            function showMe(elemt) {
                alert(elemt.innerHTML);
            }
            ]]></value>
        </property>
    </bean>
    <bean id="initContentTemplate1" class="vn.pyco.tinycms.model.ContentPageTemplate">
        <property name="template">
            <value><![CDATA[
            <p>This is a content of page '${PAGE.title}'</p>
            <p>content=${content}</p>
            ]]></value>
        </property>
    </bean>
    <bean id="initContentTemplate2" class="vn.pyco.tinycms.model.ContentPageTemplate">
        <property name="template">
            <value><![CDATA[
            <div id="bookReview">
                <img src="${book.coverImage}" title="[Cover Image]" />
                <h1>${book.title}</h1>
                <h2>Summary</h2>
                <p>${book.summary}</p>
                <h2>A Sample Page</h2>
                <div style="background-color: #efefef; font-family: Times New Roman, serif; padding: 2px">
                    ${book.samplePage}
                </div>
                <br />
                <h2>Other info</h2>
                <ul>
                    <li><strong>Published Date:</strong> ${book.publishedDate}</li>
                    <li><strong>Publisher:</strong> ${book.publisher}</li>
                    <li><strong>Reviewed:</strong> ${book.reviewed}</li>
                    <li><strong>Rate:</strong> ${book.rate}/10</li>
                    <li><strong>Price:</strong> ${book.price} USD</li>
                </ul>
            </div>
            ]]></value>
        </property>
    </bean>
</beans>